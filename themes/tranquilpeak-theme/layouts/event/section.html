{{ partial "head.html" . }}
  <body>
    <div id="blog">
      {{ partial "header.html" . }}
      {{ partial "sidebar.html" . }}
      {{ partial "post/header-cover.html" . }}
      <div id="main" data-behavior="{{ .Scratch.Get "sidebarBehavior" }}"
        class="{{ with .Params.coverimage }}hasCover{{ end }}
               {{ if eq .Params.covermeta "out" }}hasCoverMetaOut{{ else }}hasCoverMetaIn{{ end }}
               {{ with .Params.coverCaption }}hasCoverCaption{{ end }}">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          {{ with .Params.covercaption }}
            <span class="post-header-cover-caption caption">{{ . | markdownify }}</span>
          {{ end }}
          {{ if or (not .Params.coverimage) (eq .Params.covermeta "out") }}
            {{ partial "post/header.html" . }}
          {{ end }}
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">



            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            {{ if (not (eq .Params.showTags false)) }}
              {{ with .Params.tags }}
                {{ $tagsLength := len . }}
                {{ if gt $tagsLength 0 }}
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">{{ i18n "post.tagged_in" }}</span><br/>
                    {{ partial "post/tag.html" $ }}
                  </div>
                {{ end }}
              {{ end }}
            {{ end }}
            {{ partial "post/actions.html" . }}
            {{ if not (eq .Params.comments false) }}
              {{ if .Site.DisqusShortname }}
                {{ partial "post/disqus.html" . }}
              {{ end }}
            {{ end }}
          </div>
        </article>
        {{ partial "footer.html" . }}
      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="{{ .Scratch.Get "sidebarBehavior" }}">
        {{ partial "post/actions.html" . }}
      </div>
      {{ partial "post/share-options.html" . }}
    </div>

    <script src="/js/ical.min.js"></script>
    <script>
     let datelist = [];

     var iCalendarData = fetch('/event/index.ics')
       .then(r => r.text())
       .then(d => {
         //debugger
         var jcalData = ICAL.parse(d);
         var comp = new ICAL.Component(jcalData);
         var vevents = comp.getAllSubcomponents('vevent');

         vevents.forEach((v,i) => {
           let event = new ICAL.Event(v);
           //debugger
           datelist.push(event);
         });

         // main issue:
         // we need to now what is a 'proper' event
         // and what is a recurrence event.
         // the proper event should props store the uid as identifyer
         // and an iterator sequence as children.
         // we build the uid and recurrence id from the recurrence event
         // and populate the additional event info in the iterator sequence.
         // BUT the order might not work out, so we need to filter recurrence events out
         // and use them later once the base structure is made up

         datelist.forEach((v,i) => {
           //let ev = new ICAL.Component(jcalData);
           console.log(v.summary, v.startDate.toJSDate().toLocaleDateString());

           if (v.isRecurring()) {
             let counter = 0;
             let counterlimit = 10;
             //debugger
             //let now = new Date(); // figure out how to start from currrent date
             let expand = v.iterator();

             //debugger
             let next = expand.next();
             while((counter < counterlimit) && next) {
               //debugger
               //datelist.push(next);
               console.log(next.toJSDate().toLocaleDateString());
               next = expand.next();
               counter += 1;
             }
           }

         });
       });
    </script>
{{ partial "foot.html" . }}
